tinymce.PluginManager.add("autolink",function(t){function e(t){r(t,-1,"(",!0)}function n(t){r(t,0,"",!0)}function i(t){r(t,-1,"",!1)}function r(t,e,n){var i,r,a,o,c,s,l,u,f;if(i=t.selection.getRng(!0).cloneRange(),i.startOffset<5){if(u=i.endContainer.previousSibling,!u){if(!i.endContainer.firstChild||!i.endContainer.firstChild.nextSibling)return;u=i.endContainer.firstChild.nextSibling}if(f=u.length,i.setStart(u,f),i.setEnd(u,f),i.endOffset<5)return;r=i.endOffset,o=u}else{if(o=i.endContainer,3!=o.nodeType&&o.firstChild){for(;3!=o.nodeType&&o.firstChild;)o=o.firstChild;3==o.nodeType&&(i.setStart(o,0),i.setEnd(o,o.nodeValue.length))}r=1==i.endOffset?2:i.endOffset-1-e}a=r;do i.setStart(o,r>=2?r-2:0),i.setEnd(o,r>=1?r-1:0),r-=1;while(" "!=i.toString()&&""!==i.toString()&&160!=i.toString().charCodeAt(0)&&r-2>=0&&i.toString()!=n);if(i.toString()==n||160==i.toString().charCodeAt(0)?(i.setStart(o,r),i.setEnd(o,a),r+=1):0===i.startOffset?(i.setStart(o,0),i.setEnd(o,a)):(i.setStart(o,r),i.setEnd(o,a)),s=i.toString(),"."==s.charAt(s.length-1)&&i.setEnd(o,a-1),s=i.toString(),l=s.match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i),l&&("www."==l[1]?l[1]="http://www.":/@$/.test(l[1])&&!/^mailto:/.test(l[1])&&(l[1]="mailto:"+l[1]),c=t.selection.getBookmark(),t.selection.setRng(i),t.execCommand("createlink",!1,l[1]+l[2]),t.selection.moveToBookmark(c),t.nodeChanged(),tinymce.Env.webkit)){t.selection.collapse(!1);var d=Math.min(o.length,a+1);i.setStart(o,d),i.setEnd(o,d),t.selection.setRng(i)}}t.on("keydown",function(e){return 13==e.keyCode?i(t):void 0}),tinymce.Env.ie||(t.on("keypress",function(n){return 41==n.which?e(t):void 0}),t.on("keyup",function(e){return 32==e.keyCode?n(t):void 0}))});